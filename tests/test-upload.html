<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CargoX CSV Upload Test</title>
    <style>
        body {
            font-family: system-ui, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        .upload-form {
            border: 1px solid #ddd;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        .response {
            margin-top: 10px;
            padding: 10px;
            border: 1px solid #ddd;
            background-color: #f5f5f5;
            border-radius: 4px;
            overflow: auto;
            max-height: 300px;
            white-space: pre-wrap;
        }
        input[type="file"] {
            margin-bottom: 10px;
        }
        button {
            padding: 8px 16px;
            background-color: #0066cc;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        button:hover {
            background-color: #0055aa;
        }
    </style>
</head>
<body>
    <h1>CargoX CSV Upload Test</h1>
    <p>This page will test uploading CSV files to the backend running at <span id="api-url">http://localhost:8000</span></p>
    
    <div id="debug-info" style="background-color: #f8f9fa; padding: 10px; border-radius: 4px; margin-bottom: 20px;">
        <h3>Debug Information</h3>
        <div id="debug-output">Waiting for actions...</div>
    </div>
    
    <div class="upload-form">
        <h2>Upload Containers CSV</h2>
        <input type="file" id="containers-file" accept=".csv">
        <button id="upload-containers">Upload Containers</button>
        <div id="containers-response" class="response"></div>
    </div>
    
    <div class="upload-form">
        <h2>Upload Items CSV</h2>
        <input type="file" id="items-file" accept=".csv">
        <button id="upload-items">Upload Items</button>
        <div id="items-response" class="response"></div>
    </div>
    
    <div class="upload-form">
        <h2>Run Placement Algorithm</h2>
        <button id="run-placement">Run Placement</button>
        <div id="placement-response" class="response"></div>
    </div>
    
    <script>
        const API_BASE_URL = 'http://localhost:8000';
        const debugOutput = document.getElementById('debug-output');
        document.getElementById('api-url').textContent = API_BASE_URL;
        
        // Add debug info
        function addDebug(message) {
            const time = new Date().toLocaleTimeString();
            debugOutput.innerHTML += `<div>[${time}] ${message}</div>`;
        }
        
        // Import containers
        document.getElementById('upload-containers').addEventListener('click', async () => {
            const fileInput = document.getElementById('containers-file');
            const responseDiv = document.getElementById('containers-response');
            
            if (!fileInput.files || fileInput.files.length === 0) {
                responseDiv.textContent = 'Please select a file first';
                return;
            }
            
            const file = fileInput.files[0];
            addDebug(`Uploading containers file: ${file.name} (${file.size} bytes)`);
            
            // Display file contents for debugging
            const reader = new FileReader();
            reader.onload = function(e) {
                addDebug(`File contents (first 200 chars): ${e.target.result.substring(0, 200)}`);
            };
            reader.readAsText(file);
            
            try {
                responseDiv.textContent = 'Uploading...';
                
                const formData = new FormData();
                formData.append('file', file);
                
                addDebug(`Sending request to ${API_BASE_URL}/import/containers`);
                const response = await fetch(`${API_BASE_URL}/import/containers`, {
                    method: 'POST',
                    body: formData
                });
                
                const result = await response.json();
                addDebug(`Response status: ${response.status}`);
                responseDiv.textContent = JSON.stringify(result, null, 2);
            } catch (error) {
                addDebug(`Error: ${error.message}`);
                responseDiv.textContent = `Error: ${error.message}`;
            }
        });
        
        // Import items
        document.getElementById('upload-items').addEventListener('click', async () => {
            const fileInput = document.getElementById('items-file');
            const responseDiv = document.getElementById('items-response');
            
            if (!fileInput.files || fileInput.files.length === 0) {
                responseDiv.textContent = 'Please select a file first';
                return;
            }
            
            const file = fileInput.files[0];
            addDebug(`Uploading items file: ${file.name} (${file.size} bytes)`);
            
            try {
                responseDiv.textContent = 'Uploading...';
                
                const formData = new FormData();
                formData.append('file', file);
                
                addDebug(`Sending request to ${API_BASE_URL}/import/items`);
                const response = await fetch(`${API_BASE_URL}/import/items`, {
                    method: 'POST',
                    body: formData
                });
                
                const result = await response.json();
                addDebug(`Response status: ${response.status}`);
                responseDiv.textContent = JSON.stringify(result, null, 2);
            } catch (error) {
                addDebug(`Error: ${error.message}`);
                responseDiv.textContent = `Error: ${error.message}`;
            }
        });
        
        // Run placement
        document.getElementById('run-placement').addEventListener('click', async () => {
            const responseDiv = document.getElementById('placement-response');
            
            try {
                responseDiv.textContent = 'Running placement algorithm...';
                
                addDebug(`Sending request to ${API_BASE_URL}/place-items`);
                const response = await fetch(`${API_BASE_URL}/place-items`, {
                    method: 'POST'
                });
                
                const result = await response.json();
                addDebug(`Response status: ${response.status}`);
                responseDiv.textContent = JSON.stringify(result, null, 2);
            } catch (error) {
                addDebug(`Error: ${error.message}`);
                responseDiv.textContent = `Error: ${error.message}`;
            }
        });
        
        // Check API connectivity on load
        window.addEventListener('load', async () => {
            try {
                addDebug(`Checking API connectivity to ${API_BASE_URL}...`);
                const response = await fetch(API_BASE_URL);
                const data = await response.json();
                addDebug(`API is accessible! Version: ${data.version}`);
            } catch (error) {
                addDebug(`Error connecting to API: ${error.message}`);
            }
        });
    </script>
</body>
</html> 